# Story 1.1: 반복 일정 기본 설정 및 생성

## Status
Draft

## Story
**As a** 캘린더 사용자,  
**I want** 이벤트 생성 시 반복 유형과 종료 조건을 설정할 수 있다,  
**so that** 반복되는 일정을 매번 개별로 생성하지 않고 한 번에 관리할 수 있다.

## Acceptance Criteria
1. EventForm에 반복 설정 토글 스위치 추가 (기존 폼 레이아웃 유지)
2. 반복 유형 선택: 매일/매주/매월/매년 드롭다운
3. 반복 종료 날짜: 2025-10-30까지 제한된 날짜 선택기
4. **엣지 케이스 처리 (스킵 방식)**:
   - 31일 매월 반복: 31일이 없는 달에는 해당 월 이벤트 생성 스킵
   - 윤년 2월 29일 매년 반복: 평년에는 해당 연도 이벤트 생성 스킵
   - 날짜 유효성 검증: `isActualDateExists()` 함수로 실제 날짜 존재 여부 체크
5. 반복 일정들은 `repeat.id` UUID로 그룹핑하여 JSON 저장

## Tasks / Subtasks
- [ ] Task 1: RepeatInfo 인터페이스 확장 (AC: 4, 5)
  - [ ] RepeatInfo에 `endDate` 필드 추가 (YYYY-MM-DD 형식)
  - [ ] RepeatInfo에 `id` UUID 필드 추가하여 반복 그룹 식별
  - [ ] 엣지 케이스 처리를 위한 `skipInvalidDates` 필드 추가
  - [ ] 기존 Event 인터페이스와 호환성 확인 및 테스트
- [ ] Task 2: EventForm UI 확장 (AC: 1, 2, 3)
  - [ ] 기존 App.tsx의 repeat UI (440-477줄) 활용하여 endDate 필드 추가
  - [ ] 종료 날짜 선택기 구현 (2025-10-30까지 제한)
  - [ ] 기존 폼 레이아웃과 일치하는 스타일링 적용
  - [ ] 반복 설정 토글 시 관련 필드들의 표시/숨김 처리
- [ ] Task 3: 날짜 유효성 검증 유틸리티 구현 (AC: 4)
  - [ ] `isActualDateExists()` 함수를 `src/utils/dateUtils.ts`에 추가
  - [ ] 31일 매월 반복 엣지 케이스 처리 로직
  - [ ] 윤년 2월 29일 매년 반복 엣지 케이스 처리 로직
  - [ ] 유효하지 않은 날짜 스킵 로직 구현
- [ ] Task 4: useEventForm 훅 확장 (AC: 5)
  - [ ] 기존 repeat 상태에 endDate 필드 추가
  - [ ] UUID 생성 로직 추가하여 repeat.id 자동 설정
  - [ ] 폼 검증 로직에 endDate 유효성 검사 추가
- [ ] Task 5: 반복 이벤트 생성 로직 구현 (AC: 5)
  - [ ] useEventOperations에서 반복 이벤트 생성 메서드 추가
  - [ ] 엣지 케이스 처리하여 유효하지 않은 날짜는 스킵
  - [ ] 모든 반복 이벤트에 동일한 repeat.id 할당
  - [ ] JSON 저장 시 repeat 그룹 데이터 구조 확인
- [ ] Task 6: 단위 테스트 작성
  - [ ] `isActualDateExists()` 함수 테스트 (엣지 케이스 포함)
  - [ ] RepeatInfo 인터페이스 확장에 대한 타입 테스트
  - [ ] useEventForm repeat 상태 관리 테스트
  - [ ] 반복 이벤트 생성 로직 테스트
- [ ] Task 7: 통합 테스트 및 호환성 검증 (Integration Verification)
  - [ ] IV1: 기존 단일 이벤트 생성 응답시간 증가 10% 미만 확인
  - [ ] IV2: 기존 Event 타입 사용 코드 컴파일 에러 0개 확인
  - [ ] IV3: useEventOperations 기존 인터페이스 100% 호환성 확인

## Dev Notes

### Previous Story Insights
첫 번째 스토리이므로 이전 스토리 컨텍스트 없음.

### Critical Architecture Discovery
**90% 완성된 Repeat UI** [Source: architecture/핵심-발견사항.md#critical-discovery-90-완성된-repeat-ui]
- **위치**: `src/App.tsx` 440-477줄
- **현재 상태**: repeat type, interval 설정 UI 완전 구현됨
- **필요한 작업**: 추가 필드 (endDate) UI만 보완하면 됨

### Data Models
**Enhanced RepeatInfo Interface** [Source: architecture/아키텍처-설계.md#enhanced-repeatinfo-interface]
```typescript
export interface RepeatInfo {
  id?: string // UUID for grouping repeat events
  type: 'none' | 'daily' | 'weekly' | 'monthly' | 'yearly'
  interval: number
  endDate?: string // YYYY-MM-DD
  endCount?: number
  weekdays?: number[] // [1,2,3,4,5] for 월~금
  monthlyType?: 'date' | 'weekday'
  skipInvalidDates?: boolean
}
```

### Component Specifications
**기존 App.tsx Repeat UI 활용** [Source: architecture/아키텍처-설계.md#apptsx의-repeat-ui-440-477줄]
- 기존 repeat type, interval 선택 UI는 그대로 사용
- endDate 필드만 추가 구현 필요
- 스타일링은 기존 폼 레이아웃과 일치하도록 구현

### File Locations
프로젝트 구조에 따른 파일 위치:
- **Types**: `src/types.ts` (RepeatInfo 인터페이스 확장)
- **Utils**: `src/utils/dateUtils.ts` (날짜 유효성 검증 함수 추가)
- **Hooks**: `src/hooks/useEventForm.ts`, `src/hooks/useEventOperations.ts` (기존 파일 확장)
- **UI**: `src/App.tsx` (기존 440-477줄 repeat UI 확장)
- **Tests**: `src/__tests__/unit/` (유틸리티 테스트), `src/__tests__/hooks/` (훅 테스트)

### API Integration
**기존 엔드포인트 활용** [Source: architecture/통합-지점-분석.md#api-계층]
- **기존 엔드포인트**: `/api/events` 유지
- **확장 방법**: Event 인터페이스의 repeat 필드 활용
- **호환성**: 기존 데이터 100% 지원

### Testing Requirements
**테스트 커버리지 기준** [Source: architecture/품질-보증.md#테스트-커버리지]
- **유닛 테스트**: 90% 이상 (기존 유지)
- **통합 테스트**: repeat 워크플로우 100%
- **E2E 테스트**: 핵심 사용자 시나리오
- **MSW 핸들러**: 기존 구조 그대로 활용 [Source: architecture/통합-지점-분석.md#테스트-전략]

### Performance Constraints
**성능 기준** [Source: architecture/품질-보증.md#성능-기준]
- **렌더링**: <16ms (60fps 유지)
- **번들 크기**: +10KB 이하
- **로딩 시간**: <100ms 추가

### Technical Constraints
**호환성 요구사항** [Source: prd/epic-and-story-structure.md#integration-requirements]
- Event 타입 `repeat` 필드 확장 시 기존 이벤트 데이터 100% 호환성 보장
- useEventOperations 등 커스텀 훅 확장 시 기존 CRUD 성능 저하 10% 미만 유지
- MSW 테스트 환경에서 모든 반복 시나리오 재현 가능하도록 핸들러 확장

### Testing Standards
**테스트 파일 위치 및 표준**:
- 유틸리티 함수 테스트: `src/__tests__/unit/easy.dateUtils.spec.ts`에 추가
- 훅 테스트: `src/__tests__/hooks/medium.useEventForm.spec.ts` 생성
- 통합 테스트: `src/__tests__/medium.integration.spec.tsx`에 추가
- **테스트 프레임워크**: Vitest + @testing-library/react-hooks
- **MSW 핸들러**: `src/__mocks__/handlers.ts` 확장

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-26 | 1.0 | Initial story creation | scrum-master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*This section will be populated by the QA agent during review*